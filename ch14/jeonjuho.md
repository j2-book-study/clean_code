# 점진적인 개선

- 좋은 코드는 여기저기 뒤적일 필요 없이 위에서 아래로 코드가 읽힌다.
- 특정 객체의 코드를 직접 보지 않더라도 어떤 역할과 기능을 수행하는 객체인지 이해할 수 있다.
- 자바와 같은 정적 타입 언어를 사용하면 타입 시스템을 만족하기 위해 많은 단어가 필요하지만, 루비, 파이썬 등의 언어를 사용하면 더 간단하게 구현할 수 있다.
- 좋은 예시 코드를 살펴보면 새로운 유형의 추가 혹은 파생된 기능을 구현하기에 유연한 깔끔한 구조를 갖는다.

## 어떻게 코드를 짜는건가?

- 깨끗하고 우아한 프로그램을 한 방에 뚝딱 내놓으리라 기대하지 않는다.
- 깨끗한 코드를 짜기 위해서는 먼저 지저분한 코드를 짠 뒤에 정리해야 한다.

## 1차 초안

- 코드는 ‘돌아가지만’ 엉망인 상태이다.
- 많은 인스턴스 변수들과 파악하기 힘든 값, HashSet, try-catch-catch 블록 등이 지저분한 코드를 만들었다.
- 예시 코드에서는 Boolean 타입의 인수 유형을 우선 만들고 String, Integer 타입의 인수 유형을 추가하는 순서로 개발을 진행했다.
- 인수 유형을 추가하는 과정에서 코드가 점차 지저분해지며 버그와 결함이 숨어있을 수 있는 의심스러운 코드가 되었다.

### 그래서 멈췄다

- 만약 특정 기능을 수정한다면 각각의 인수 유형에서 동일한 수정이 반복되어야 하는 등의 문제가 있었다.
- 인수 유형을 더 추가해야 하는 상황에서 개발을 멈추고 리팩터링을 시작했다.

## 점진적으로 개선하다

- TDD를 사용해서 시스템을 망가뜨리는 변경을 허용하지 않았으며 이를 검증했다.
- 우선적으로 구현된 클래스의 단위 테스트와 인수 테스트를 작성하여 언제든 실행 가능하도록 한다.
- 이후 작은 수정을 지속적으로 진행하며 테스트의 성공을 유지한다.
    - 테스트에 실패하지 않도록 하는 것이 가장 중요하다.
- SRP 원칙을 지키기 위해 메서드와 클래스의 분할을 고려한다.

### 예시 코드에서 얻은 개선하는 팁들

- 모든 논리를 바로 파생 클래스로 만드는 대신 추상 클래스에 우선 만든다.
    - 프로그램 구조를 조금씩 변경하는 동안 시스템의 정상 동작을 유지하기 쉬워진다.
    - 사용하는 클래스에서는 어디에 있는 지가 중요하지는 않다. 지금 집중해야 하는 곳을 먼저 수정하고, 이후에 추상 클래스에서 파생 클래스로의 리팩터링을 진행한다.
- 여러 타입의 유형들을 추가하기 위해서 한 번에 수정하는 것이 아니라 하나씩 수정한다.
    - 복잡한 생각을 할 필요가 없어지고 작은 단위의 수정을 이어나가며 기존의 테스트를 성공하는지 파악하기 쉽다.
    - 어떤 부분을 추상화하거나 기존 추상화를 유지해야 하는지 파악하기 좋다.
- 리팩터링을 진행하다 보면 코드를 넣었다 뺐다 하는 사례가 아주 흔하다.
    - 큰 목표 하나를 이루기 위해 자잘한 단계를 수없이 거치며, 각 단계를 거쳐야 다음 단계가 가능하다.

## 결론

- 나쁜 코드는 썩어 문드러진다.
    - 바쁜 일정에 맞추기 위해 이를 무시하고 진행하면 오히려 속도가 더 느려진다.
- 오래된 나쁜 코드를 수정하는 것보다 방금 만든 코드를 정리하는 것이 더 쉽다.